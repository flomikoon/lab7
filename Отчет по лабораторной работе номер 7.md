# Цели
Получить практические навыки разработки сервисов (started и bound) и Broadcast Receivers.
# Задачи
Задача 1. Started сервис для скачивания изображения

В лабораторной работе №6 был разработан код, скачивающий картинку из интернета. На основе этого кода разработайте started service, скачивающий файл из интернета. URL изображения для скачивания должен передаваться в Intent. Убедитесь (и опишите доказательство в отчете), что код для скачивания исполняется не в UI потоке
Добавьте в разработанный сервис функцию отправки broadcast сообщения по завершении скачивания. Сообщение (Intent) должен содержать путь к скачанному файлу.

MainActivity

![logo](https://i.ibb.co/yVdnd12/image.png)

![logo](https://i.ibb.co/JcVbX2g/image.png)

Результаты работы приложения: 

![logo](https://i.ibb.co/BGsJszq/image.png)

Был создан класс сервис в котором  был переопределен метод onBind , в данном задание он будет возращать null так как нам нужен Started service. Из MainActivity мы запускаем наш сервис с помощью метода startService в который передается Intent с ссылкой на скачиваемое изображение. Так же был переопределен метод onStartCommand при помощт корутины мы загружаем изображение в IO потоке и отправляем место положение скаченного изображения через Broadcast. После чего сервис завершает работу. Узнать в каком потоке выполняется мы выполняем скачивание можно с помощью вызова метода Thread.currentThread().name и как мы можем видеть из сообщения скачивание выполняется не в главном потоке.

Задача 2. Broadcast Receiver

Разработайте два приложения: первое приложение содержит 1 activity с 1 кнопкой, при нажатии на которую запускается сервис по скачиванию файла. Второе приложение содержит 1 broadcast receiver и 1 activity. Broadcast receiver по получении сообщения из сервиса инициирует отображение пути к изображению в TextView в Activity.

MainActivity

![logo](https://i.ibb.co/JnXbV3n/image.png)

Результаты работы приложения: 

![logo](https://i.ibb.co/pWc1tPL/image.png)

Был создан BroadcastReceiver , нам нужно сначало зарегистрировать его ,после чего мы сможем обробатывать широковещительные сообщения которые будут отправляться из приложения которое было реализованно в первом задание , после приема сообщения мы запускаем новую активити и отоброжаем в TextView сообщение которое мы приняли ,а именно местоположение скаченного изобюражения.

Задача 3. Bound Service для скачивания изображения

Сделайте разработанный сервис одновременно bound И started: переопределите метод onBind. Из тела метода возвращайте IBinder, полученный из класса Messenger. Убедитесь (доказательство опишите в отчете), что код скачивания файла исполняется не в UI потоке.

Измените способ запуска сервиса в первом приложении: вместо startService используйте bindService. При нажатии на кнопку отправляйте сообщение Message, используя класс Messenger, полученный из интерфейса IBinder в методе onServiceConnected.

Добавьте в первое приложение TextView, а в сервис отправку обратного сообщения с местоположением скачанного файла. При получении сообщения от сервиса приложение должно отобразить путь к файлу на экране.

Обратите внимание, что разработанный сервис должен быть одновременно bound И started. Если получен интент через механизм started service, то сервис скачивает файл и отправляет broadcast (started service не знает своих клиентов и не предназначен для двухсторонней коммуникации). Если получен message через механизм bound service, то скачивается файл и результат отправляется тому клиенту, который запросил этот файл (т.к. bound service знает всех своих клиентов и может им отвечать).

MainActivity

![logo](https://i.ibb.co/1qWRXxD/image.png)

![logo](https://i.ibb.co/0BgJXnc/image.png)

DownloadService

![logo](https://i.ibb.co/ZT4HkhN/image.png)

Handlers

![logo](https://i.ibb.co/KNTSw8t/image.png)

Результаты работы приложения:

![logo](https://i.ibb.co/8zNZ8Wf/image.png)

![logo](https://i.ibb.co/VDTFWNT/image.png)


Разработанное приложение может работать в 2 режимах , первый режим это Started Service , его работа была продимонстрированна в первом задании. Второй режим это Bound Service , для этого режима я переопределил метод onBind и теперь можно связать сервис и нашу активити , для этого в методе onCreate мы вызываем метод bindService в который подается Intent c классом нашего сервиса , объект класса ServiceConnection с помощью которого можно отслеживать состояние сервиса , так же в нем есть переменная класса Messenger значение которой будет получено из результата метода onBind. Из метода мы получим экземпляр класса IBinder, являющийся итерфейсом взаимодействия внутрипроцессных и межпроцессных взаимодействий. Данный IBinder получается путем создания нового Messenger, в конструктор которого передается класс DownloaderHandler, который нужен для описания взаимойствия между сервисом и Activity.
Далее в ServiceConnection из полученного IBinder будет сделанн снова Messenger и мы можем обращаться к нему с помощью класса  Message в котором есть поле obj в котором храниться пересылаемая информация , поле what которое нужно для индетефикации сообщения и поле replyTo мы можем указать Messenger куда мы можем отправлять обратные сообщения.
DownloaderHandler запускает загрузку изображения , после чего он отправляет сообщение для Messenger который был помещен в replyTo в Activity , после чего ResponseHandler мы отображаем место положение скаченной картинки на экранне.
# Вывод
В данной работе я познакомился с started(не знает своих клиентов и не предназначен для двухсторонней коммуникации) и bound(знает всех своих клиентов и может им отвечать) сервисами , а так же с отпракой и обработкой Broadcast-сообщений.

